{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vaibh/Desktop/blog-app/src/app/api/blogs/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nfunction getUserIdFromRequest(request) {\r\n  // support user-id header (from middleware) or Authorization: Bearer <token>\r\n  const userIdHeader = request.headers.get('user-id');\r\n  if (userIdHeader) return parseInt(userIdHeader);\r\n\r\n  const auth = request.headers.get('authorization') || request.headers.get('Authorization');\r\n  if (!auth) return null;\r\n  const parts = auth.split(' ');\r\n  const token = parts.length === 2 && parts[0] === 'Bearer' ? parts[1] : parts[0];\r\n  try {\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n    return decoded.userId;\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\n// GET all blogs\r\nexport async function GET() {\r\n  try {\r\n    const blogs = await prisma.blog.findMany({\r\n      include: {\r\n        author: {\r\n          select: {\r\n            id: true,\r\n            name: true,\r\n            email: true\r\n          }\r\n        }\r\n      },\r\n      orderBy: {\r\n        createdAt: 'desc'\r\n      }\r\n    });\r\n\r\n    return NextResponse.json(blogs);\r\n  } catch (error) {\r\n    console.error('Error fetching blogs:', error);\r\n    return NextResponse.json(\r\n      { error: 'Error fetching blogs' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// POST new blog\r\nexport async function POST(request) {\r\n  try {\r\n    const { title, content } = await request.json();\r\n    const userId = getUserIdFromRequest(request);\r\n\r\n    if (!userId) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const blog = await prisma.blog.create({\r\n      data: {\r\n        title,\r\n        content,\r\n        authorId: parseInt(userId)\r\n      },\r\n      include: {\r\n        author: {\r\n          select: {\r\n            id: true,\r\n            name: true,\r\n            email: true\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    return NextResponse.json(blog);\r\n  } catch (error) {\r\n    console.error('Error creating blog:', error);\r\n    return NextResponse.json(\r\n      { error: 'Error creating blog' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAE/B,SAAS,qBAAqB,OAAO;IACnC,4EAA4E;IAC5E,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC;IACzC,IAAI,cAAc,OAAO,SAAS;IAElC,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB,QAAQ,OAAO,CAAC,GAAG,CAAC;IACzE,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,QAAQ,KAAK,KAAK,CAAC;IACzB,MAAM,QAAQ,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,WAAW,KAAK,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE;IAC/E,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QACxD,OAAO,QAAQ,MAAM;IACvB,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM,OAAO,IAAI,CAAC,QAAQ,CAAC;YACvC,SAAS;gBACP,QAAQ;oBACN,QAAQ;wBACN,IAAI;wBACJ,MAAM;wBACN,OAAO;oBACT;gBACF;YACF;YACA,SAAS;gBACP,WAAW;YACb;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAC7C,MAAM,SAAS,qBAAqB;QAEpC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC;YACpC,MAAM;gBACJ;gBACA;gBACA,UAAU,SAAS;YACrB;YACA,SAAS;gBACP,QAAQ;oBACN,QAAQ;wBACN,IAAI;wBACJ,MAAM;wBACN,OAAO;oBACT;gBACF;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAsB,GAC/B;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}